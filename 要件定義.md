# 保育料自動計算ツール ― ディレクトリ構成

> **Next.js 14（App Router）＋ TypeScript** を前提としたプロジェクト構成例です。<br>プロジェクトルートは `my-hoikuryo-app/` を想定しています。

```text
my-hoikuryo-app/
├─ .vscode/                 # 推奨拡張機能・設定（任意）
│   └─ settings.json
├─ public/                  # 静的アセット
│   └─ favicon.svg
├─ src/
│   ├─ app/                 # App Router ルート
│   │   ├─ layout.tsx       # 全ページ共通レイアウト
│   │   ├─ globals.css      # Tailwind + 役場カラー変数
│   │   └─ page.tsx         # メインページ（フォーム & 結果表示）
│   ├─ components/          # 再利用 UI コンポーネント
│   │   ├─ FormStepper.tsx
│   │   ├─ IncomeField.tsx  # 年収 or 所得入力
│   │   ├─ SelectChildOrder.tsx
│   │   ├─ SelectTimeType.tsx  # 保育標準時間／短時間
│   │   └─ FeeResultCard.tsx
│   ├─ lib/                 # ビジネスロジック & ユーティリティ
│   │   ├─ hoikuryo/        # 保育料計算モジュール群
│   │   │   ├─ index.ts     # ← 先ほどの **hoikuryo.ts** を改名して配置
│   │   │   ├─ tables/
│   │   │   │   ├─ under3_standard.json  # 3歳未満・標準時間
│   │   │   │   ├─ under3_short.json     # 3歳未満・短時間
│   │   │   │   ├─ over3_standard.json   # 3歳児以上・標準時間
│   │   │   │   └─ over3_short.json      # 3歳児以上・短時間
│   │   │   ├─ salaryDeduction.ts  # 給与所得控除テーブル
│   │   │   └─ constants.ts        # 基礎控除・税率など共通定数
│   │   ├─ hooks/
│   │   │   └─ useHoikuryo.ts      # 入力→計算→結果を返すカスタム Hook
│   │   └─ utils/
│   │      └─ format.ts            # 数値フォーマッタ（カンマ区切り等）
│   ├─ types/
│   │   └─ hoikuryo.d.ts           # FamilyInput 等の共有型
│   └─ tests/
│      ├─ hoikuryo.test.ts
│      └─ ui.test.tsx
├─ scripts/                # 補助スクリプト（データ更新など）
│   └─ import-pdf.ts       # PDF → JSON 変換ワークフロー（年次更新用）
├─ .eslintrc.js
├─ jest.config.js
├─ next.config.js
├─ postcss.config.js
├─ tailwind.config.ts
├─ tsconfig.json
└─ package.json
```

## 1. フォルダの役割

| ディレクトリ                | 目的                                                 |
| --------------------- | -------------------------------------------------- |
| **/src/app**          | ページ・レイアウト。Next.js App Router 規約に従う。                |
| **/src/components**   | Presentational コンポーネント。状態を持たず、Props で操作。           |
| **/src/lib/hoikuryo** | 保育料計算の純粋ロジック。フロント以外（Node.js バッチ等）でも再利用可。           |
| **/src/hooks**        | UI とロジックを繋ぐカスタム Hook。フォームバリデーション・再計算タイミングを集中管理。    |
| **/src/tests**        | Jest + React Testing Library による単体／結合テスト。CI で自動実行。 |
| **/scripts**          | PDF から階層表 JSON を生成するノードスクリプトなど。年次改定時のみ使用。          |

## 2. JSON データファイル命名規則

* `{ageCategory}_{timeType}.json` 形式（例: `under3_standard.json`）。
* JSON スキーマ例:

  ```json
  [
    { "min": 0, "max": 0, "fee_first": 0, "fee_second": 0, "fee_third": 0 },
    { "min": 1, "max": 4800, "fee_first": 5500, "fee_second": 2750, "fee_third": 0 }
  ]
  ```

  * `fee_first` = 第1子基準額
  * 第2子・第3子は多子軽減後の額をプリセットしておくと計算が単純化。

## 3. コード分割ポリシー

1. **計算ロジックは UI から完全分離**：`lib/hoikuryo` 配下のみで完結。単体テスト対象。
2. **フォーム → Hook → 計算モジュール** の流れで依存方向を一方向に保つ。
3. **スタイリングは Tailwind Utility** + `clsx` のみ。テーマカラーは `tailwind.config.ts` で拡張。

## 4. 開発・デプロイ

| コマンド            | 内容                             |
| --------------- | ------------------------------ |
| `pnpm dev`      | ローカル開発サーバ起動 (`localhost:3000`) |
| `pnpm test`     | Jest でユニットテスト実行                |
| `pnpm lint`     | ESLint & TypeScript チェック       |
| `pnpm build`    | Next.js 本番ビルド                  |
| `vercel --prod` | Vercel へ本番デプロイ                 |

CI パイプライン（GitHub Actions）では `test & lint → build` が通れば自動で Vercel Preview 環境へ。

## 5. 今後の拡張 Hook

* **usePdfExport**：`react-pdf` で結果カードを PDF 生成。
* **useLocalStorage**：直近入力値をブラウザ保存し、再訪時に復元。

---

この構成であれば、フロントエンドだけで保育料の入力～計算～表示が完結し、年次改定時は JSON を差し替えるだけで運用できます。